<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Productivity Tracker & Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; background:#f5f5f5; padding:20px; margin:0; }
        .container { background:white; padding:20px; border-radius:10px; max-width:950px; margin:auto; box-shadow:0 0 10px #ccc; margin-bottom:30px; }
        input, textarea, select { width:100%; padding:8px; margin:5px 0 10px; border:1px solid #aaa; border-radius:6px; box-sizing:border-box; }
        button { padding:10px 20px; border:none; background:#333; color:white; border-radius:6px; cursor:pointer; margin-top:10px; margin-right:5px; }
        table { width:100%; margin-top:20px; border-collapse:collapse; }
        th, td { padding:10px; border:1px solid #ddd; text-align:center; }
        th { background:#333; color:white; }
        .success { color:green; font-weight:bold; }
        .fail { color:red; font-weight:bold; }
        h2,h3 { margin-bottom:10px; }
        canvas { margin-top:20px; max-width:100%; }
        @media (max-width: 600px) {
            .container { padding:10px; }
            button { width:100%; margin-bottom:10px; }
        }
    </style>
</head>
<body>

<div class="container">
    <h2>تتبع الإنتاجية - Productivity Tracker</h2>
    <h3>إضافة سجل يومي</h3>

    <label>اسم الموظف:</label>
    <select id="name">
        <option value="Mahmoud">Mahmoud</option>
        <option value="Mohamed">Mohamed</option>
        <option value="Adham">Adham</option>
    </select>

    <label>ساعات العمل الفعلية:</label>
    <input type="number" id="hours" min="0" max="8">

    <label>عدد المكالمات:</label>
    <input type="number" id="calls" min="0">

    <label>نوت / ملاحظة:</label>
    <textarea id="note"></textarea>

    <label>التاريخ:</label>
    <input type="date" id="date">

    <button onclick="addRecord()">إضافة</button>
    <button onclick="exportExcel()">تصدير Excel</button>

    <h3>سجلات الشهر</h3>
    <table id="recordsTable">
        <tr>
            <th>الاسم</th>
            <th>الساعات</th>
            <th>المكالمات</th>
            <th>تحقيق التارجت</th>
            <th>النوت</th>
            <th>اليوم</th>
        </tr>
    </table>
</div>

<div class="container">
    <h2>Dashboard الفريق</h2>
    <canvas id="callsChart" height="150"></canvas>
    <canvas id="targetChart" height="150"></canvas>
</div>

<script>
    let records = [];
    function addRecord() {
        let name = document.getElementById("name").value;
        let hours = Number(document.getElementById("hours").value);
        let calls = Number(document.getElementById("calls").value);
        let note = document.getElementById("note").value;
        let date = document.getElementById("date").value;

        if (!hours || !calls || !date) {
            alert("من فضلك املأ كل البيانات الأساسية");
            return;
        }

        let required = hours * 17;
        let achieved = calls >= required;

        let record = { name, hours, calls, note: note||"-", date, achieved, required };
        records.push(record);

        renderTable();
        saveToLocalStorage();
        updateCharts();
    }

    function renderTable() {
        let table = document.getElementById("recordsTable");
        table.innerHTML = `
            <tr>
                <th>الاسم</th>
                <th>الساعات</th>
                <th>المكالمات</th>
                <th>تحقيق التارجت</th>
                <th>النوت</th>
                <th>اليوم</th>
            </tr>
        `;
        for (let r of records) {
            let row = table.insertRow(-1);
            row.innerHTML = `
                <td>${r.name}</td>
                <td>${r.hours}</td>
                <td>${r.calls}</td>
                <td class="${r.achieved ? 'success' : 'fail'}">
                    ${r.achieved ? "✔ محقق" : "✘ غير محقق"} (المطلوب: ${r.required})
                </td>
                <td>${r.note}</td>
                <td>${r.date}</td>
            `;
        }
    }

    function saveToLocalStorage() { localStorage.setItem("prodData", JSON.stringify(records)); }
    function loadFromLocalStorage() {
        let saved = localStorage.getItem("prodData");
        if (saved) { records = JSON.parse(saved); renderTable(); updateCharts(); }
    }

    function exportExcel() {
        let table = document.getElementById("recordsTable");
        let workbook = XLSX.utils.book_new();
        let sheet = XLSX.utils.table_to_sheet(table);
        XLSX.utils.book_append_sheet(workbook, sheet, "Productivity");
        XLSX.writeFile(workbook, "productivity_report.xlsx");
    }

    // Dashboard
    let callsChart, targetChart;
    function updateCharts() {
        let names = ["Mahmoud","Mohamed","Adham"];
        let totalCalls = names.map(n => records.filter(r => r.name===n).reduce((a,b)=>a+b.calls,0));
        let targetAchieved = names.map(n => {
            let empRecords = records.filter(r => r.name===n);
            let totalRequired = empRecords.reduce((a,b)=>a+b.required,0);
            let totalDone = empRecords.reduce((a,b)=>a+b.calls,0);
            return totalRequired===0 ? 0 : Math.round((totalDone/totalRequired)*100);
        });

        if (callsChart) callsChart.destroy();
        let ctx1 = document.getElementById("callsChart").getContext("2d");
        callsChart = new Chart(ctx1, {
            type: 'bar', data: { labels: names, datasets: [{ label: 'إجمالي المكالمات', data: totalCalls, backgroundColor: ['#3e95cd','#8e5ea2','#3cba9f'] }] },
            options: { responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
        });

        if (targetChart) targetChart.destroy();
        let ctx2 = document.getElementById("targetChart").getContext("2d");
        targetChart = new Chart(ctx2, {
            type: 'bar', data: { labels: names, datasets: [{ label: 'نسبة تحقيق التارجت %', data: targetAchieved, backgroundColor: ['#ff6384','#36a2eb','#ffce56'] }] },
            options: { responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true, max:100}} }
        });
    }

    loadFromLocalStorage();
</script>

</body>
</html>
